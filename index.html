import { useState, useCallback } from "react";

const LANGS = [
  { v: "Arabic", l: "ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", rtl: true },
  { v: "Franco Arabic", l: "ğŸ”¤ ÙØ±Ø§Ù†ÙƒÙˆ", rtl: false },
  { v: "English", l: "ğŸ‡¬ğŸ‡§ English", rtl: false },
  { v: "French", l: "ğŸ‡«ğŸ‡· FranÃ§ais", rtl: false },
  { v: "Spanish", l: "ğŸ‡ªğŸ‡¸ EspaÃ±ol", rtl: false },
  { v: "German", l: "ğŸ‡©ğŸ‡ª Deutsch", rtl: false },
  { v: "Italian", l: "ğŸ‡®ğŸ‡¹ Italiano", rtl: false },
  { v: "Portuguese", l: "ğŸ‡µğŸ‡¹ PortuguÃªs", rtl: false },
  { v: "Russian", l: "ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹", rtl: false },
  { v: "Chinese", l: "ğŸ‡¨ğŸ‡³ ä¸­æ–‡", rtl: false },
  { v: "Japanese", l: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª", rtl: false },
  { v: "Korean", l: "ğŸ‡°ğŸ‡· í•œêµ­ì–´", rtl: false },
  { v: "Turkish", l: "ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e", rtl: false },
  { v: "Persian", l: "ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ", rtl: true },
  { v: "Urdu", l: "ğŸ‡µğŸ‡° Ø§Ø±Ø¯Ùˆ", rtl: true },
  { v: "Hindi", l: "ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€", rtl: false },
  { v: "Hebrew", l: "ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª", rtl: true },
  { v: "Dutch", l: "ğŸ‡³ğŸ‡± Nederlands", rtl: false },
  { v: "Polish", l: "ğŸ‡µğŸ‡± Polski", rtl: false },
  { v: "Swedish", l: "ğŸ‡¸ğŸ‡ª Svenska", rtl: false },
  { v: "Greek", l: "ğŸ‡¬ğŸ‡· Î•Î»Î»Î·Î½Î¹ÎºÎ¬", rtl: false },
  { v: "Indonesian", l: "ğŸ‡®ğŸ‡© Indonesia", rtl: false },
  { v: "Thai", l: "ğŸ‡¹ğŸ‡­ à¸ à¸²à¸©à¸²à¹„à¸—à¸¢", rtl: false },
  { v: "Vietnamese", l: "ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t", rtl: false },
  { v: "Ukrainian", l: "ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°", rtl: false },
  { v: "Swahili", l: "ğŸ‡°ğŸ‡ª Kiswahili", rtl: false },
];

function buildPrompt(text, src, tgt) {
  if (src === "Franco Arabic")
    return `Expert Franco Arabic (Arabizi) translator. Translate to ${tgt}. ONLY the translation.\n3=Ø¹,2=Ø£,7=Ø­,5=Ø®\nText: ${text}`;
  if (tgt === "Franco Arabic")
    return `Expert Franco Arabic (Arabizi) translator. Convert ${src} to Arabizi. ONLY Arabizi output.\n3=Ø¹,2=Ø£,7=Ø­,5=Ø®\nText: ${text}`;
  return `Translate from ${src} to ${tgt}. ONLY the translation, no extra text.\nText: ${text}`;
}

export default function Boda() {
  const [src, setSrc] = useState("Arabic");
  const [tgt, setTgt] = useState("English");
  const [input, setInput] = useState("");
  const [output, setOutput] = useState("");
  const [loading, setLoading] = useState(false);
  const [toast, setToast] = useState("");
  const [cpIn, setCpIn] = useState(false);
  const [cpOut, setCpOut] = useState(false);

  const si = LANGS.find(l => l.v === src) || LANGS[0];
  const ti = LANGS.find(l => l.v === tgt) || LANGS[2];

  const notify = m => { setToast(m); setTimeout(() => setToast(""), 2500); };

  const swap = () => {
    const ps = src, pt = tgt, po = output;
    setSrc(pt); setTgt(ps);
    if (po) { setInput(po); setOutput(""); }
  };

  const copy = async w => {
    const t = w === "in" ? input : output;
    if (!t) { notify("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ"); return; }
    try { await navigator.clipboard.writeText(t); } catch { notify("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®"); return; }
    if (w === "in") { setCpIn(true); setTimeout(() => setCpIn(false), 1500); }
    else { setCpOut(true); setTimeout(() => setCpOut(false), 1500); }
  };

  const translate = useCallback(async () => {
    if (loading) return;
    const text = input.trim();
    if (!text) { notify("Ø§ÙƒØªØ¨ Ù†ØµØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹"); return; }
    if (src === tgt) { notify("Ø§Ø®ØªØ± Ù„ØºØªÙŠÙ† Ù…Ø®ØªÙ„ÙØªÙŠÙ†"); return; }
    setLoading(true); setOutput("");
    try {
      const res = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 2000,
          messages: [{ role: "user", content: buildPrompt(text, src, tgt) }]
        })
      });
      const d = await res.json();
      if (!res.ok) throw new Error(d.error?.message);
      setOutput((d.content?.[0]?.text || "").trim());
    } catch { notify("âš ï¸ Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"); }
    finally { setLoading(false); }
  }, [loading, input, src, tgt]);

  const bg = "#080b11", sf = "#0f1521", sf2 = "#151d2e", br = "#1a2540";
  const ac = "#3b82f6", ac2 = "#60a5fa", tx = "#e2e8f0", mu = "#4a5a72", di = "#94a3b8", gr = "#10b981";

  const sel = { flex: 1, padding: "11px 10px", borderRadius: 10, background: sf2, border: `1px solid ${br}`, color: tx, fontFamily: "inherit", fontSize: "0.87rem", fontWeight: 600, cursor: "pointer", outline: "none" };
  const ib = ok => ({ width: 30, height: 30, borderRadius: 7, background: ok ? "rgba(16,185,129,0.12)" : "transparent", border: "none", color: ok ? gr : mu, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontSize: "0.85rem" });

  return (
    <div dir="rtl" style={{ minHeight: "100vh", background: bg, color: tx, fontFamily: "'Cairo','Segoe UI',sans-serif", position: "relative", overflow: "hidden" }}>

      <div style={{ position: "fixed", width: 600, height: 600, borderRadius: "50%", background: "radial-gradient(circle,rgba(59,130,246,0.07),transparent 70%)", top: -200, right: -150, filter: "blur(100px)", pointerEvents: "none", zIndex: 0 }} />
      <div style={{ position: "fixed", width: 400, height: 400, borderRadius: "50%", background: "radial-gradient(circle,rgba(99,102,241,0.05),transparent 70%)", bottom: -100, left: -100, filter: "blur(90px)", pointerEvents: "none", zIndex: 0 }} />

      {/* Header */}
      <div style={{ position: "sticky", top: 0, zIndex: 100, background: "rgba(8,11,17,0.92)", backdropFilter: "blur(18px)", borderBottom: `1px solid ${br}`, padding: "0 24px", height: 60, display: "flex", alignItems: "center", justifyContent: "space-between" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <div style={{ width: 36, height: 36, background: `linear-gradient(135deg,${ac},#6366f1)`, borderRadius: 9, display: "flex", alignItems: "center", justifyContent: "center", fontSize: "1rem", boxShadow: `0 4px 14px rgba(59,130,246,0.3)` }}>ğŸŒ</div>
          <div>
            <div style={{ fontSize: "1.35rem", fontWeight: 900, letterSpacing: -1 }}>Bo<span style={{ color: ac2 }}>da</span></div>
            <div style={{ fontSize: "0.6rem", color: mu, letterSpacing: 2, textTransform: "uppercase" }}>Smart Translator</div>
          </div>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 6, padding: "5px 11px", background: sf, border: `1px solid ${br}`, borderRadius: 20, fontSize: "0.7rem", color: mu }}>
          <div style={{ width: 6, height: 6, background: gr, borderRadius: "50%", animation: "pulse 2s infinite" }} /> AI Active
        </div>
      </div>

      {/* Main */}
      <div style={{ position: "relative", zIndex: 1, maxWidth: 920, margin: "0 auto", padding: "40px 16px 56px" }}>

        {/* Hero */}
        <div style={{ textAlign: "center", marginBottom: 36 }}>
          <div style={{ display: "inline-flex", alignItems: "center", gap: 6, padding: "5px 13px", background: "rgba(59,130,246,0.08)", border: "1px solid rgba(59,130,246,0.2)", borderRadius: 20, marginBottom: 14, fontSize: "0.74rem", color: "#93c5fd", letterSpacing: 0.5 }}>âœ¦ Ù…ØªØ±Ø¬Ù… Ø°ÙƒÙŠ Â· Smart Translator</div>
          <h1 style={{ fontSize: "clamp(1.8rem,4vw,2.8rem)", fontWeight: 900, lineHeight: 1.2, letterSpacing: -1, marginBottom: 10 }}>
            <span style={{ background: "linear-gradient(90deg,#60a5fa,#93c5fd)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>Boda</span> â€” ØªØ±Ø¬Ù… Ø¨Ø³Ù‡ÙˆÙ„Ø©
          </h1>
          <p style={{ color: di, fontSize: "0.93rem", fontWeight: 300 }}>ØªØ±Ø¬Ù…Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø¨ÙŠÙ† 26 Ù„ØºØ© â€” Ø¨Ø¯Ù‚Ø© ÙˆÙˆØ¶ÙˆØ­</p>
        </div>

        {/* Lang bar */}
        <div style={{ display: "flex", alignItems: "center", gap: 8, background: sf, border: `1px solid ${br}`, borderRadius: 13, padding: 8, marginBottom: 11 }}>
          <select style={sel} value={src} onChange={e => setSrc(e.target.value)}>
            {LANGS.map(l => <option key={l.v} value={l.v}>{l.l}</option>)}
          </select>
          <button onClick={swap} style={{ width: 40, height: 40, borderRadius: 9, background: sf2, border: `1px solid ${br}`, color: mu, cursor: "pointer", fontSize: "1.15rem", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}>â‡„</button>
          <select style={sel} value={tgt} onChange={e => setTgt(e.target.value)}>
            {LANGS.map(l => <option key={l.v} value={l.v}>{l.l}</option>)}
          </select>
        </div>

        {/* Panels */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 11, marginBottom: 11 }}>

          <div style={{ background: sf, border: `1px solid ${br}`, borderRadius: 13, display: "flex", flexDirection: "column" }}>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "8px 12px", background: sf2, borderBottom: `1px solid ${br}`, borderRadius: "13px 13px 0 0" }}>
              <span style={{ fontSize: "0.73rem", fontWeight: 700, color: mu, letterSpacing: 1, textTransform: "uppercase" }}>{src}</span>
              <div style={{ display: "flex", gap: 3 }}>
                <button style={ib(false)} onClick={() => { setInput(""); setOutput(""); }}>âœ•</button>
                <button style={ib(cpIn)} onClick={() => copy("in")}>{cpIn ? "âœ“" : "â§‰"}</button>
              </div>
            </div>
            <textarea value={input} onChange={e => setInput(e.target.value)}
              onKeyDown={e => { if ((e.ctrlKey || e.metaKey) && e.key === "Enter") translate(); }}
              dir={si.rtl ? "rtl" : "ltr"}
              placeholder={src === "Arabic" ? "Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§â€¦" : src === "Franco Arabic" ? "Ekteb henaâ€¦ e.g. ana ta3ban" : `Type in ${src}â€¦`}
              style={{ flex: 1, minHeight: 190, background: "transparent", border: "none", outline: "none", color: tx, fontFamily: "inherit", fontSize: "1rem", lineHeight: 1.8, padding: 14, resize: "none" }}
            />
            <div style={{ padding: "6px 12px", borderTop: `1px solid ${br}`, fontSize: "0.68rem", color: mu }}>{input.length} {si.rtl ? "Ø­Ø±Ù" : "chars"}</div>
          </div>

          <div style={{ background: sf, border: `1px solid ${br}`, borderRadius: 13, display: "flex", flexDirection: "column" }}>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "8px 12px", background: sf2, borderBottom: `1px solid ${br}`, borderRadius: "13px 13px 0 0" }}>
              <span style={{ fontSize: "0.73rem", fontWeight: 700, color: mu, letterSpacing: 1, textTransform: "uppercase" }}>{tgt}</span>
              <button style={ib(cpOut)} onClick={() => copy("out")}>{cpOut ? "âœ“" : "â§‰"}</button>
            </div>
            <div dir={ti.rtl ? "rtl" : "ltr"} style={{ flex: 1, minHeight: 190, padding: 14, fontSize: "1rem", lineHeight: 1.8, whiteSpace: "pre-wrap", wordBreak: "break-word", color: loading ? ac2 : output ? tx : mu }}>
              {loading ? "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©â€¦" : output || "Ø³ØªØ¸Ù‡Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù‡Ù†Ø§â€¦"}
            </div>
            <div style={{ padding: "6px 12px", borderTop: `1px solid ${br}`, fontSize: "0.68rem", color: mu }}>{output ? `${output.length} ${ti.rtl ? "Ø­Ø±Ù" : "chars"}` : ""}</div>
          </div>
        </div>

        {/* Button */}
        <button onClick={translate} disabled={loading}
          style={{ width: "100%", padding: 15, background: loading ? "rgba(59,130,246,0.35)" : `linear-gradient(135deg,${ac},#6366f1)`, border: "none", borderRadius: 13, color: "#fff", fontFamily: "inherit", fontSize: "1.08rem", fontWeight: 700, cursor: loading ? "not-allowed" : "pointer", display: "flex", alignItems: "center", justifyContent: "center", gap: 10, boxShadow: loading ? "none" : `0 4px 20px rgba(59,130,246,0.25)` }}>
          {loading
            ? <><span style={{ width: 19, height: 19, border: "2px solid rgba(255,255,255,0.3)", borderTopColor: "#fff", borderRadius: "50%", display: "inline-block", animation: "spin 0.65s linear infinite" }} /> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©â€¦</>
            : "ğŸŒ   ØªØ±Ø¬Ù… Ø§Ù„Ø¢Ù†"}
        </button>
        <div style={{ textAlign: "center", marginTop: 8, fontSize: "0.67rem", color: mu }}>
          <kbd style={{ background: sf2, border: `1px solid ${br}`, borderRadius: 4, padding: "1px 5px", fontSize: "0.62rem" }}>Ctrl</kbd> + <kbd style={{ background: sf2, border: `1px solid ${br}`, borderRadius: 4, padding: "1px 5px", fontSize: "0.62rem" }}>Enter</kbd> Ù„Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
        </div>
      </div>

      <div style={{ textAlign: "center", padding: 18, fontSize: "0.67rem", color: mu, borderTop: `1px solid ${br}`, position: "relative", zIndex: 1 }}>
        Boda Â· Powered by Claude AI
      </div>

      {toast && <div style={{ position: "fixed", bottom: 26, left: "50%", transform: "translateX(-50%)", background: "#1e293b", border: "1px solid #ef4444", color: "#fca5a5", padding: "10px 18px", borderRadius: 11, fontSize: "0.86rem", zIndex: 999, whiteSpace: "nowrap" }}>{toast}</div>}

      <style>{`
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
        @keyframes spin{to{transform:rotate(360deg)}}
        select option{background:#111827}
        *{box-sizing:border-box}
        @media(max-width:560px){
          [data-grid]{grid-template-columns:1fr!important}
        }
      `}</style>
    </div>
  );
}